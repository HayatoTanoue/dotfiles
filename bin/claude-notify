#!/bin/bash
# Claude Code notification script
# macOS: sound + OS notification with project name
# Linux/SSH: terminal bell + tmux message with project name

# extract project name from stdin JSON
INPUT=$(cat)
CWD=$(echo "$INPUT" | jq -r '.cwd // empty' 2>/dev/null)
PROJECT=$(basename "${CWD:-unknown}")

if [ "$(uname)" = "Darwin" ]; then
  afplay /System/Library/Sounds/Glass.aiff &
  osascript -e "display notification \"入力を待っています\" with title \"Claude Code: $PROJECT\"" 2>/dev/null
else
  # send bell + tmux message to the client tty
  if [ -n "$TMUX" ]; then
    TTY=$(tmux display-message -p '#{client_tty}')
    printf '\a' > "$TTY"
    tmux display-popup -w 40 -h 3 -d 3 -style "bg=#1a1b26,fg=#7aa2f7" "echo '  Claude Code: $PROJECT 完了'"
  else
    printf '\a'
  fi
fi
