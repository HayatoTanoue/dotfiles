#!/bin/bash
# Claude Code notification script
# macOS: sound + OS notification with project name
# Linux/SSH: terminal bell + tmux message with project name

# extract project name from stdin JSON
INPUT=$(cat)
CWD=$(echo "$INPUT" | jq -r '.cwd // empty' 2>/dev/null)
PROJECT=$(basename "${CWD:-unknown}")

if [ "$(uname)" = "Darwin" ]; then
  afplay /System/Library/Sounds/Glass.aiff &
  osascript -e "display notification \"å…¥åŠ›ã‚’å¾…ã£ã¦ã„ã¾ã™\" with title \"Claude Code: $PROJECT\"" 2>/dev/null
else
  # send bell + tmux message to the client tty
  if [ -n "$TMUX" ]; then
    TTY=$(tmux display-message -p '#{client_tty}')
    printf '\a' > "$TTY"
    tmux set -g message-style "bg=#f7768e,fg=#1a1b26,bold"
    tmux display-message -d 5000 "  ðŸ”” Claude Code: $PROJECT å®Œäº†  "
    # restore original message style after display
    (sleep 6 && tmux set -g message-style "bg=#7aa2f7,fg=#1a1b26") &
  else
    printf '\a'
  fi
fi
