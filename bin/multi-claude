#!/bin/bash
# 複数ペインの tmux セッションを開く（SSH先で実行）
# 使い方: multi-claude [columns]
#   multi-claude        - 2列構成 (デフォルト)
#   multi-claude 3      - 3列構成
#   multi-claude 4      - 4列構成
#
# レイアウト (例: 3列):
# ┌──────────┬──────────┬──────────┐
# │ terminal │ terminal │ terminal │
# ├──────────┼──────────┼──────────┤
# │ terminal │ terminal │ terminal │
# └──────────┴──────────┴──────────┘

COLS="${1:-2}"
SESSION="multi-claude"

if tmux has-session -t ${SESSION} 2>/dev/null; then
  tmux attach -t ${SESSION}
  exit 0
fi

tmux new-session -d -s ${SESSION}

# 横方向に分割 (columns - 1 回)
for i in $(seq 2 ${COLS}); do
  tmux split-window -h -t ${SESSION}
  tmux select-layout -t ${SESSION} even-horizontal
done

# 各列を縦に分割 (逆順で番号ずれを防止)
for i in $(seq $(( ${COLS} - 1 )) -1 0); do
  tmux split-window -v -t ${SESSION}:0.${i}
done

tmux select-pane -t ${SESSION}:0.0
tmux attach -t ${SESSION}
